---
title: "éå»ã«èã„ãŸæ›²ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’æ¯é€±ãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹botã‚’ä½œã£ãŸ(Last.fm)"
emoji: "ğŸ "
type: "idea"
topics:
  - "python"
  - "twitter"
  - "api"
  - "bot"
  - "lastfm"
published: true
published_at: "2021-08-01 17:38"
---

:::message
ã“ã®è¨˜äº‹ã¯[ã“ã¡ã‚‰ã®è¨˜äº‹](https://qiita.com/Sorara33/items/5f4a0069183a35b0a4b8)ã‚’è»¢è¼‰ã—ãŸã‚‚ã®ã§ã™ã€‚ï¼ˆå…ƒè¨˜äº‹ã‚‚ç§ãŒæ›¸ãã¾ã—ãŸï¼‰
é–‹ç™ºã¯2020å¹´ã«è¡Œã£ãŸãŸã‚ã€ç¾åœ¨ã¯ã‚³ãƒ¼ãƒ‰ãŒå‹•ä½œã—ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
:::

**å®Œæˆç‰©ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç”»åƒâ†“**
![](https://storage.googleapis.com/zenn-user-upload/04b06a67fa2654821726cf85.png =300x)

**å®Œæˆç‰©ã®ãƒ„ã‚¤ãƒ¼ãƒˆâ†“**
@[tweet](https://twitter.com/sorarakara/status/1377584183367843843?s=20)


# ã©ã‚“ãªBotï¼Ÿ
æ¯é€±ã€æ¯æœˆã€æ¯å¹´ã€ã‚¹ãƒãƒ›ã‚„PCã§èã„ãŸæ¥½æ›²ã®å†ç”Ÿå›æ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’ãƒ„ã‚¤ãƒ¼ãƒˆã—ã¾ã™ã€‚
### ãƒ„ã‚¤ãƒ¼ãƒˆå†…å®¹
- é †ä½ï¼ˆ10ä½ã¾ã§ï¼‰
- ã‚¿ã‚¤ãƒˆãƒ«
- ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ
- å†ç”Ÿå›æ•°


# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
https://github.com/Sorara33/last-fm-twitter

# å¯¾è±¡è€…
ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¶…åˆå¿ƒè€…ä»¥å¤–ã‚’æƒ³å®šã—ã¾ã—ãŸã€‚
ã‚‚ã—ã‚‚Pythonã¨Herokuã‚’ä½¿ç”¨ã—ãŸçµŒé¨“ãŒã‚ã‚Œã°ã€Last.fmã®ç™»éŒ²ã‚’ã—ã¦ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã™ã‚Œã°å¤šåˆ†ã™ãã«ã§ãã¾ã™ã€‚

# å‰æ
[Last.fm](https://www.last.fm/ja/)ã¨ã„ã†ã‚µãƒ¼ãƒ“ã‚¹ã«ç™»éŒ²ã—ã¦ãŠã„ã¦ã€ä½•æ›²ã‹éŸ³æ¥½ã‚’Scrobbleï¼ˆå†ç”Ÿã—ãŸæ¥½æ›²ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¨˜éŒ²ï¼‰ã—ã¦ãŠã„ã¦ãã ã•ã„ã€‚ã‚‚ã¡ã‚ã‚“ç„¡æ–™ã€‚
PCã§ã‚‚ã‚¹ãƒãƒ›ã§ã‚‚ã€å¯¾å¿œã™ã‚‹ã‚¢ãƒ—ãƒªã‚’å…¥ã‚Œã‚Œã°è‡ªå‹•ã§è¨˜éŒ²ã—ã¦ãã‚Œã¾ã™ã€‚ï¼’ã¤ä»¥ä¸Šã®scrobbleã‚½ãƒ•ãƒˆã‚’ä½¿ã†ã¨è¨˜éŒ²ãŒé‡è¤‡ã—ã¦ã—ã¾ã†ã®ã§æ³¨æ„ã€‚
Androidã‚¹ãƒãƒ›ã ã¨ã€ãŠã™ã™ã‚ã¯[ã“ã®ã‚¢ãƒ—ãƒª](https://play.google.com/store/apps/details?id=com.peterjosling.scroball&hl=ja)ã€‚
é€šä¿¡ãƒ‡ãƒ¼ã‚¿é‡ã¯ã»ã¼ãªã—ã€‚
è©³ã—ãã¯ã‚°ã‚°ã£ã¦ãã ã•ã„ã€‚

## ç’°å¢ƒ
- ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªï¼šPython 3.7.3
- ä½¿ç”¨APIï¼šLast.fm API
- ä½¿ç”¨SDKï¼šTweepy, line-bot-sdk(LINE Bot)
- ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆï¼šHeroku
- ãƒ­ãƒ¼ã‚«ãƒ«PCï¼šMac OS
- é–‹ç™ºç’°å¢ƒï¼ˆIDEï¼‰ï¼šPycharm CE

# æ‰‹é †
## ç’°å¢ƒã‚’æ§‹ç¯‰
Pythonã‚„PyCharmãªã©ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚


## APIé–¢é€£ã®ç™»éŒ²
### 1. Twitter 
[Twitter Developerã®ãƒšãƒ¼ã‚¸](https://developer.twitter.com/)ã§ç™»éŒ²ã¾ãŸã¯ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã€ä»Šå›ä½œã‚‹Botç”¨ã®Appã‚’ä½œæˆã—ã¾ã™ã€‚
ãã—ã¦ã€ä½œæˆã—ãŸAppã®
CONSUMER_KEY
CONSUMER_SECRET
ACCESS_TOKEN
ACCESS_TOKEN_SECRET
ã®ï¼”ã¤ã‚’ãƒ¡ãƒ¢ã—ã¾ã—ã‚‡ã†ã€‚

è©³ã—ãã¯ã€ã‚°ã‚°ã£ã¦ãã ã•ã„ã€‚


### 2. Last.fm
ã¨ã‚Šã‚ãˆãšAPIå…¬å¼ãƒšãƒ¼ã‚¸ã¯[ã“ã¡ã‚‰](https://www.last.fm/api/)ã€‚
ã‚ã¾ã‚Šè¤‡é›‘ãªæ§‹æˆã§ã¯ãªã„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã ã¨æ€ã„ã¾ã™ï¼ˆè‹±èªã§ã™ãŒï¼‰ã€‚

#### APIã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹
ã‚‚ã—ã‚‚Last.fmã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œã£ã¦ã„ãªã„å ´åˆã¯ã€APIã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œã‚‹å‰ã«ç™»éŒ²ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚
æ™®é€šã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒã‚ã‚Œã°ã€[ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²ãƒšãƒ¼ã‚¸](https://www.last.fm/api/account/create)ã§APIã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ç™»éŒ²ã‚’ã—ã¾ã™ã€‚
Callback URLã¯ã€ä»Šå›ã¯å…¥åŠ›ä¸è¦ã§ã™ã€‚
Application homepageã‚‚ã€ç©ºæ¬„ã§ã„ã„ã¿ãŸã„ã§ã™ã€‚

ç™»éŒ²å®Œäº†ãƒšãƒ¼ã‚¸ã§å‡ºã¦ãã‚‹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã¯å¿…ãšãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚
API KEYã¯çµ¶å¯¾ã«ä½¿ã„ã¾ã™ã€‚
ã¾ã‚ã€ä½•ã‹ã§å¤±æ•—ã—ãŸã‚‰ä½•åº¦ã§ã‚‚ä½œã‚Šç›´ã›ã¾ã™ã€‚

#### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚€
ã¨è¨€ã£ã¦ã‚‚ä»Šå›ä½¿ã†ã®ã¯[user.getTopTracks](https://www.last.fm/api/show/user.getTopTracks)ã¨ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ã®ã¿ã€‚
èª­ã¾ãªãã¦ã„ã„ã§ã™ã€‚å¾Œè¿°ã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒšã—ã¦ãã ã•ã„ã€‚
HTTP GETã§ã€æŒ‡å®šã—ãŸç›´è¿‘ã®æœŸé–“ã§èã„ãŸæ›²ãŒã€å†ç”Ÿå›æ•°ã®å¤šã„é †ã«å–å¾—ã§ãã¾ã™ã€‚
ãƒ‡ãƒ¼ã‚¿ã¯XMLå½¢å¼ã¨JSONå½¢å¼ã‚’é¸ã‚“ã§å–å¾—ã§ãã¾ã™ãŒã€ä»Šå›ã¯JSONã‚’é¸ã‚“ã§ã„ã¾ã™ã€‚

## ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã
**å†’é ­ã®importç›´å¾Œã®ç’°å¢ƒå¤‰æ•°ã¸ã®ä»£å…¥ã¯ã€å„è‡ªã®æƒ…å ±ã‚’Herokuã®ç’°å¢ƒå¤‰æ•°ã«ç™»éŒ²ã—ã¦ä½¿ã£ã¦ãã ã•ã„ã€‚**
ã¾ãŸã€ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ãƒ‡ãƒãƒƒã‚¯ã‚’è¡Œã„ã€å®Ÿéš›ã«æ­£ã—ããƒ„ã‚¤ãƒ¼ãƒˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

:::details ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
```python:main.py
import os

import tweepy
import urllib.request
import json
import unicodedata
import datetime
from PIL import Image, ImageFont, ImageDraw
import random
import dropbox
import sys


from linebot import (
    LineBotApi, WebhookHandler
)
from linebot.exceptions import (
    InvalidSignatureError
)
from linebot.models import (
    MessageEvent, TextMessage, TextSendMessage, ImageSendMessage
)

YOUR_CHANNEL_ACCESS_TOKEN = os.environ['LineMessageAPIChannelAccessToken']
YOUR_CHANNEL_SECRET = os.environ['LineMessageAPIChannelSecret']
line_bot_api = LineBotApi(YOUR_CHANNEL_ACCESS_TOKEN)
handler = WebhookHandler(YOUR_CHANNEL_SECRET)

TWITTER_CONSUMER_KEY = os.environ['TWITTER_CONSUMER_KEY']
TWITTER_CONSUMER_SECRET = os.environ['TWITTER_CONSUMER_SECRET']
TWITTER_ACCESS_TOKEN = os.environ['TWITTER_ACCESS_TOKEN']
TWITTER_ACCESS_TOKEN_SECRET = os.environ['TWITTER_ACCESS_TOKEN_SECRET']

DROPBOX_TOKEN = os.environ['DROPBOX_TOKEN']

LASTFM_API_KEY = os.environ['LASTFM_API_KEY']

LINE_USER_ID = os.environ['LINE_USER_ID']

global period
global theme_color


class Period:
    SEVEN_DAYS = '7day'
    ONE_MONTH = '1month'
    TWELVE_MONTH = '12month'


FONT1 = 'fonts/azuki.ttf'             # http://azukifont.com/font/azuki.html
FONT2 = 'fonts/Ronde-B_square.otf'    # https://moji-waku.com/ronde/
FONT3 = 'fonts/851letrogo_007.ttf'    # http://pm85122.onamae.jp/851letrogopage.html
FONT4 = 'fonts/logotypejp_mp_b_1.1.ttf'   # https://logotype.jp/corporate-logo-font-dl.html#i-11
FONT5 = 'fonts/logotypejp_mp_m_1.1.ttf'   # https://logotype.jp/corporate-logo-font-dl.html#i-11


def main():
    data = get_last_fm_tracks()
    # ãƒ„ã‚¤ãƒ¼ãƒˆã™ã‚‹æ–‡å­—åˆ—
    tweet_str = initial_tweet_str()
    draw_ranking_img(data)

    twitter_api = initialize_twitter_api()
    twitter_api.update_with_media(filename='ranking.jpg', status=tweet_str)
    img_url1, img_url2 = upload_img_to_dropbox()
    line_send_message(tweet_str, img_url1, img_url2)


def initialize_twitter_api():
    auth = tweepy.OAuthHandler(TWITTER_CONSUMER_KEY, TWITTER_CONSUMER_SECRET)
    auth.set_access_token(TWITTER_ACCESS_TOKEN, TWITTER_ACCESS_TOKEN_SECRET)
    return tweepy.API(auth)


def get_last_fm_tracks():
    global period
    url = 'http://ws.audioscrobbler.com/2.0/'
    params = {
        'format': 'json',
        'api_key': LASTFM_API_KEY,
        'method': 'user.getTopTracks',
        'user': 'SoraraP',
        'period': period,
    }
    req = urllib.request.Request('{}?{}'.format(url, urllib.parse.urlencode(params)))
    with urllib.request.urlopen(req) as res:
        body = res.read()
        body = json.loads(body)
        return body


def initial_tweet_str():
    tweet = 'ãã‚‰ã‚‰PãŒ'
    if period == Period.SEVEN_DAYS:
        tweet += 'ä»Šé€±'
    elif period == Period.ONE_MONTH:
        tweet += 'å…ˆæœˆ'
    elif period == Period.TWELVE_MONTH:
        tweet += 'ä»Šå¹´'
    tweet += 'èã„ãŸæ›²ãƒ©ãƒ³ã‚­ãƒ³ã‚°\n'
    return tweet[:-1]


def draw_ranking_img(data):
    global period
    global theme_color
    theme_color = (random.randint(0, 255), random.randint(0, 255), random.randint(0, 255))
    img_size = (1080, 2160)
    img = Image.new('RGB', img_size, color=theme_color)
    draw = ImageDraw.Draw(img)
    
    # ç”»åƒè¦‹å‡ºã—
    font_size = 70
    font = ImageFont.truetype(font=FONT4, size=font_size)
    position = (int(img_size[0] / 2 - draw.textsize(initial_tweet_str(), font)[0] / 2), 10)
    draw.text(xy=position, text=initial_tweet_str(), fill='white', font=font)
    
    draw_table(draw, img_size, data)
    
    # æ—¥ä»˜
    font_size = 40
    font = ImageFont.truetype(font=FONT4, size=font_size)
    position = (img_size[0] - draw.textsize(str(today), font)[0] - 10, img_size[1] - draw.textsize(str(today), font)[1] -10)
    draw.text(xy=position, text=str(today), fill='white', font=font)
    
    img.save('ranking.jpg')
    img2 = img.resize((120, 240))
    img2.save('ranking_preview.jpg')


def draw_table(draw, size, data):
    global theme_color
    width, height = size
    num_songs = 10

    margin_top = 100
    margin_bottom = 50
    side_margin = 20
    
    left_top = (side_margin, margin_top)
    right_top = (width - side_margin, margin_top)
    left_bottom = (side_margin, height - margin_bottom)
    right_bottom = (width - side_margin, height - margin_bottom)
    
    # å››è§’
    draw.rectangle((left_top, right_bottom), fill='white', width=0)
    draw.line((left_top, left_bottom), fill=theme_color, width=5)
    draw.line((right_top, right_bottom), fill=theme_color, width=5)
    draw.line((left_top, right_top), fill=theme_color, width=5)
    draw.line((left_bottom, right_bottom), fill=theme_color, width=5)
    
    table_height = height - margin_top - margin_bottom
    
    # æ¨ªç·š
    xy = (left_top, right_top)
    for n in range(num_songs):
        xy = [list(xy[0]), list(xy[1])]
        xy[0][1] = xy[0][1] + int(table_height/11)
        xy[1][1] = xy[0][1]
        xy = (tuple(xy[0]), tuple(xy[1]))
        draw.line(xy, fill=theme_color, width=5)
    
    # ç¸¦ç·š
    rank_width = 100
    xy = (left_top[0] + rank_width, left_top[1], left_bottom[0] + rank_width, left_bottom[1])
    draw.line(xy, fill=theme_color, width=5)
    
    titles, artists, playcount = ['ã‚¿ã‚¤ãƒˆãƒ«'], ['ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ'], ['å†ç”Ÿå›æ•°']
    track_num = 0
    for track in data['toptracks']['track']:
        if track_num < num_songs:
            if int(track['playcount']) >= 1:
                titles.append(track['name'])
                artists.append(track['artist']['name'])
                playcount.append(track['playcount'])
                track_num += 1
    if track_num != num_songs:
        print('å†ç”Ÿå±¥æ­´ãŒå°‘ãªã™ãã¾ã™')
        sys.exit()
                
    # é †ä½
    rank_size = 80
    rank_xy = (left_top[0] + 10, left_top[1] + 10)
    for n in range(num_songs + 1):
        if n == 0:
            font = ImageFont.truetype(font=FONT1, size=rank_size)
            text = 'é †\nä½'
            draw.text(xy=rank_xy, text=text, fill=0, font=font)
        else:
            text = str(n)
            if n < 10:
                rank_size = 100
                rank_xy = (left_top[0] + 25, left_top[1] + 10 + n*int(table_height/(num_songs+1)))
            else:
                rank_size = 85
                rank_xy = (left_top[0] + 5, left_top[1] + 10 + n*int(table_height/(num_songs+1)))
            font = ImageFont.truetype(font=FONT3, size=rank_size)
            draw.text(xy=rank_xy, text=text, fill='purple', font=font)

    # ã‚¿ã‚¤ãƒˆãƒ«
    title_size = 75
    font = ImageFont.truetype(font=FONT4, size=title_size)
    title_xy = (left_top[0] + rank_width + 20, left_top[1] + 10)
    for n in range(num_songs + 1):
        draw.text(xy=title_xy, text=titles[n], fill=(255, 130, 39), font=font)
        title_xy = list(title_xy)
        title_xy[1] = title_xy[1] + int(table_height/(num_songs+1))
        title_xy = tuple(title_xy)
    
    # å†ç”Ÿå›æ•°
    playcount_xy = (left_top[0] + rank_width + 20, left_top[1] + 110)
    playcount_size = 60
    font = ImageFont.truetype(font=FONT5, size=playcount_size)
    for n in range(num_songs + 1):
        text = playcount[n]
        if n != 0:  # å‡¡ä¾‹ã«ã¯ã€Œå›ã€ã‚’ä»˜ã‘ãªã„
            text += 'å›'
        draw.text(xy=playcount_xy, text=text, fill=0, font=font)
        playcount_xy = list(playcount_xy)
        playcount_xy[1] = playcount_xy[1] + int(table_height/(num_songs+1))
        playcount_xy = tuple(playcount_xy)
    
    # ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ
    for n in range(num_songs + 1):
        artist = '' + artists[n]
        artist_xy = (width - side_margin - draw.textsize(artist, font)[0] - 20,
                     left_top[1] + 110 + n * int(table_height/(num_songs+1)))
        artist_size = 65
        font = ImageFont.truetype(font=FONT5, size=artist_size)
        while draw.textsize(artist, font)[0] > width - 2*side_margin - rank_width - 200:
            artist = artist[:-2] + 'â€¦'
            artist_xy = (width - side_margin - draw.textsize(artist, font)[0] - 20,
                         left_top[1] + 110 + n * int(table_height / (num_songs + 1)))
        font = ImageFont.truetype(font=FONT5, size=artist_size)
        draw.text(xy=artist_xy, text=artist, fill='black', font=font)
        artist_xy = list(artist_xy)
        artist_xy[1] = artist_xy[1] + int(table_height/(num_songs+1))
        artist_xy = tuple(artist_xy)
    

def len_tweet(text):
    count = 0
    for c in text:
        if unicodedata.east_asian_width(c) in 'Na':
            count += 1
        else:
            count += 2
    return count


def upload_img_to_dropbox():
    dbx = dropbox.Dropbox(DROPBOX_TOKEN)
    # dbx.users_get_current_account()
    with open('ranking.jpg', "rb") as f:
        dbx.files_upload(f.read(), '/ranking.jpg', mode=dropbox.files.WriteMode.overwrite)
    with open('ranking_preview.jpg', "rb") as f:
        dbx.files_upload(f.read(), '/ranking_preview.jpg', mode=dropbox.files.WriteMode.overwrite)
    
    # ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªãƒ³ã‚¯ã‚’å–å¾—
    # setting = dropbox.sharing.SharedLinkSettings(requested_visibility=dropbox.sharing.RequestedVisibility.public)
    # link = dbx.sharing_create_shared_link_with_settings(path='/ranking.jpg', settings=setting)
    # links = dbx.sharing_list_shared_links(path='/ranking.jpg', direct_only=True).links
    # if links is not None:
    #     for link in links:
    #         img_url = link.url
    #         img_url = img_url.replace('www.dropbox', 'dl.dropboxusercontent').replace('?dl=0', '')
    #         print(img_url)
    #         return img_url

    # ä¸Šã®æ–¹æ³•ã ã¨linkå–å¾—æ™‚ã«shared_link_already_existsã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹
    # ãŸã ã—urlã¯æ¯å›ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚‹ã€‚
    return 'https://dl.dropboxusercontent.com/s/thcrs9h1x1031ti/ranking.jpg', \
           'https://dl.dropboxusercontent.com/s/thcrs9h1x1031ti/ranking_preview.jpg'


def line_send_message(text, img_url1, img_url2):
    user_id = LINE_USER_ID
    messages = [
        ImageSendMessage(
            original_content_url=img_url1,
            preview_image_url=img_url2
        ),
        TextSendMessage(text=text)
    ]
    line_bot_api.push_message(user_id, messages=messages)


if __name__ == "__main__":
    global period
    today = datetime.date.today()
    weekday = today.weekday()
    day = today.day
    month = today.month

    if weekday == 6:  # Sunday
        period = Period.SEVEN_DAYS
        main()
    if day == 1:
        period = Period.ONE_MONTH
        main()
    if month == 12 and day == 30:
        period = Period.TWELVE_MONTH
        main()
    print(today)
    print('process end.')
```
:::

periodå¤‰æ•°ã¯æœ€åˆã¯å¼•æ•°ã§æ¸¡ã—ã¦ã„ã“ã†ã¨ã—ã¾ã—ãŸãŒã€ãªãœã‹ifæ–‡ã®æ¯”è¼ƒãŒã†ã¾ãã§ããªã‹ã£ãŸã®ã§ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«ã—ã¾ã—ãŸã€‚
æ”¹è‰¯æ¡ˆãŒã‚ã‚Œã°ã€ã‚³ãƒ¡ãƒ³ãƒˆã‚‚ã‚‰ãˆã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚


## Herokuã®å‰æº–å‚™
### Herokuã«ç™»éŒ²
Herokuã«ç™»éŒ²ã—ã¾ã™ã€‚
è©³ã—ãã¯ã‚°ã‚°ã£ã¦ãã ã•ã„ã€‚
### Heroku CLIã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
ã“ã†ã„ã†ã¨ã“ã‚ãŒã¡ã‚‡ã£ã¨é¢å€’ã¨æ„Ÿã˜ã¾ã—ãŸã€‚
[ã“ã¡ã‚‰ã®è¨˜äº‹](https://qiita.com/seigo-pon/items/ca9951dac0b7fa29cce0#herokucli%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## Herokuã«ãƒ‡ãƒ—ãƒ­ã‚¤
[ã“ã¡ã‚‰ã®è¨˜äº‹](https://qiita.com/1-row/items/80f89c8ada2e61f04446)ã‚’è¦‹ãªãŒã‚‰è¡Œã„ã¾ã—ãŸã€‚

```
# é–¢é€£ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ä¸€è¦§ã‚’ä½œæˆ
pip freeze > requirements.txt
# ãƒ­ãƒ¼ã‚«ãƒ«ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒã™ã¹ã¦ãŒå‡ºåŠ›ã•ã‚Œã¦ã—ã¾ã†ã®ã§ã€ä¸è¦ãªã‚‚ã®ã¯å‰Šé™¤ã™ã‚‹ã“ã¨
```
ã“ã“â†‘ã§ã™ãŒã€ç§ã®å ´åˆã¯requirements.txtã¯ä¸‹è¨˜â†“ã®æ„Ÿã˜ã§OKã§ã—ãŸã€‚

```
jsonschema
tweepy
unicodecsv
urllib3
requests
requests-oauthlib
click
line-bot-sdk
pillow
dropbox
chardet
```

## Herokuã§ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å®šæœŸå®Ÿè¡Œã‚’è¨­å®šã™ã‚‹
ã“ã‚Œã‚‚[ã“ã¡ã‚‰ã®è¨˜äº‹](https://qiita.com/seigo-pon/items/ca9951dac0b7fa29cce0#%E5%AE%9A%E6%9C%9F%E5%AE%9F%E8%A1%8C%E8%A8%AD%E5%AE%9A)ã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€‚Heroku Schedulerã¨ã„ã†ã‚¢ãƒ‰ã‚ªãƒ³ã‚’ä½¿ã†ã¨ã„ã„ã‚‰ã—ã„ã§ã™ã€‚
è¨­å®šã¯ã€ç§ã®å ´åˆã¯å…¨ã¦ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ã§ãã¾ã—ãŸã€‚
ãƒ•ã‚£ãƒ¼ãƒªãƒ³ã‚°ã§ã‚‚ã„ã‘ã‚‹ã¨æ€ã„ã¾ã™ãŒã€é©å®œã‚°ã‚°ã£ã¦ãã ã•ã„ã€‚

ã¡ãªã¿ã«ã€Heroku Schedulerã§ã¯ã€Œæ¯é€±ã€ã¨ã„ã†é …ç›®ãŒãªã‹ã£ãŸãŸã‚ã€ã€Œæ¯æ—¥ã€ã§è¨­å®šã—ã¾ã™ã€‚ï¼ˆä¸Šã®ã‚³ãƒ¼ãƒ‰ã‚‚ãã‚ŒãŒå‰æã§ã™ï¼‰
ã¾ãŸã€æ™‚é–“è¨­å®šã¯ä¸–ç•Œå”å®šæ™‚åˆ»ã®ã¿å¯¾å¿œã—ã¦ã„ã‚‹ã‚‰ã—ãã€è¨­å®šã—ãŸã„æ—¥æœ¬æ™‚é–“ã‹ã‚‰ï¼™æ™‚é–“å¼•ã„ãŸå€¤ã«ã—ã¾ã™ã€‚
æ¯æ—¥åˆå¾Œï¼™æ™‚ã«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã—ãŸã„å ´åˆã«ã¯ã€ä¸‹ã®ç”»åƒã®ã‚ˆã†ã«è¨­å®šã—ã¾ã—ãŸã€‚
![Heroku Schedulerã®è¨­å®š](https://storage.googleapis.com/zenn-user-upload/aa60ccf9f32a1335da276ab0.png)

## éŸ³æ¥½ã‚’èãã¾ãã‚‹
ãŸãã•ã‚“éŸ³æ¥½ã‚’èã„ã¦ã€Last.fmã§scrobbleã—ã¾ã—ã‚‡ã†ã€‚


## æœ€å¾Œã«
ã“ã®è¨˜äº‹ã®ç·¨é›†é€”ä¸­ã«ãƒšãƒ¼ã‚¸é·ç§»ã—ã¦ã—ã¾ã£ã¦ã€æˆ»ã‚‹ã¨å†…å®¹ãŒã™ã”ãé¡ã£ãŸçŠ¶æ…‹ã«ãªã£ã¦ã¦é’ã–ã‚ãŸã‘ã©ã€ä¸‹æ›¸ãä¿å­˜ã—ãŸã‚‰ã¡ã‚ƒã‚“ã¨å›å¾©ã—ã¦ãŸã€‚
